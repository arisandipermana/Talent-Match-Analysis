import pandas as pd
import numpy as np
import gdown
from datetime import datetime
import matplotlib.pyplot as plt
import seaborn as sns

# Import dataset from gdrive
from google.colab import drive
drive.mount('/content/drive')

# show the table of leads
df_final_match = pd.read_csv("final_match.csv")
df_final_match.head()

# Ambil rata-rata final match rate per employee
df_final = df_final_match.groupby(['employee_id', 'fullname'])['final_match_rate'].mean().reset_index()
# Urutkan dari yang tertinggi
df_final = df_final.sort_values(by='final_match_rate', ascending=False)
# Ambil top 10 aja biar jelas
top_n = 10
df_top = df_final.head(top_n)
# Plot ulang
plt.figure(figsize=(8, 5))
plt.barh(df_top['fullname'], df_top['final_match_rate'], color='steelblue')
plt.xlabel('Final Match Rate (%)')
plt.ylabel('Employee')
plt.title(f'Top {top_n} Employees by Final Match Rate')
plt.gca().invert_yaxis()  # biar ranking tertinggi di atas
plt.tight_layout()
plt.show()

import plotly.express as px
# Pilih salah satu kandidat top
emp_id = df_top.iloc[0]['employee_id']
emp_name = df_top.iloc[0]['fullname']
# Ambil data per TGV
df_emp = df_final_match[df_final_match['employee_id'] == emp_id].groupby('tgv_name')['tgv_match_rate'].mean().reset_index()
# Radar chart
fig = px.line_polar(df_emp, r='tgv_match_rate', theta='tgv_name', line_close=True,
                    title=f'TGV Match Profile - {emp_name}')
fig.update_traces(fill='toself')
fig.show()

pivot_df = df_final_match.pivot_table(index='tgv_name', columns='tv_name', values='tv_match_rate')
plt.figure(figsize=(10,6))
sns.heatmap(pivot_df, annot=False, cmap='YlGnBu')
plt.title('TV Match Rate by TGV')
plt.show()

from IPython.display import Markdown, display

profile_text = generate_job_profile(
    role_name="Data Analyst",
    job_level="Middle",
    role_purpose="Transform complex datasets into actionable insights that support business decision-making.",
    top_tgvs=["Cognitive & Problem-Solving", "Collaboration & Teamwork", "Strategic Thinking"]
)

display(Markdown(profile_text))
